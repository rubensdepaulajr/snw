@model IEnumerable<br.com.totaltiss.Model.Atz_Esp>

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqGrid")

@{
    ViewBag.Title = "Especialiddes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<p>
    @Html.ActionLink("Adicionar", "Create")
</p>

    <link rel="stylesheet" type="text/css" media="screen" href="~/Content/jquery.jqGrid/ui.jqGrid.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="~/Scripts/css/redmond/jquery-ui-1.8.18.custom.css" />

<script type="text/javascript">
    $(document).ready(function () {
        BuildGrid();
    });

    function BuildGrid() {
        var lastSel;
        jQuery("#grid").jqGrid({
            url: '@Url.Action("Lista", "Especialidade")',
            @*editurl: '@Url.Action("delete", "Especialidade")',*@
            datatype: 'json',
            mtype: 'GET',
            colNames: ['Id', 'Nome', 'CBO', 'Gestão', 'Compl?', 'Sexo', 'Mín.', 'Máx.', 'Máx.', 'Dia', 'Mês', 'Ano', 'Retorno','...'],
            colModel: [
              { name: 'IdEsp', index: 'IdEsp', width: 25, align: 'left', formatter: linkFormatter },
              { name: 'Esp_Dsc', index: 'Esp_Dsc', width: 230, align: 'left' },
              { name: 'Esp_Cbo', index: 'Esp_Cbo', width: 35, align: 'center' },
              { name: 'Esp_SisGst', index: 'Esp_SisGst', width: 50, align: 'rigt' },
              { name: 'Esp_AltCpx', index: 'Esp_AltCpx', width: 45, align: 'center', formatter: 'checkbox' },
              { name: 'Esp_Sxo', index: 'Esp_Sxo', width: 35, align: 'center' },
              { name: 'Esp_IddMin', index: 'Esp_IddMin', width: 25, align: 'center' },
              { name: 'Esp_IddMax', index: 'Esp_IddMax', width: 25, align: 'center' },
              { name: 'Esp_QtdMax', index: 'Esp_QtdMax', width: 25, align: 'center' },
              { name: 'Esp_QtdDia', index: 'Esp_QtdDia', width: 25, align: 'center' },
              { name: 'Esp_QtdMes', index: 'Esp_QtdMes', width: 25, align: 'center' },
              { name: 'Esp_QtdAno', index: 'Esp_QtdAno', width: 25, align: 'center' },
              { name: 'Esp_Rtn', index: 'Esp_Rtn', width: 45, align: 'center' },

              { name: 'IdEsp', index: 'IdEsp', width: 60, align: 'center', formatter: CompetenciaFormatter }
            ],
            width: 800,
            height: 350,
            pager: jQuery('#pager'),
            rowNum: 15,
            rowList: [5, 15, 30, 50],
            sortname: 'IdEsp',
            sortorder: "desc",
            viewrecords: true,
            caption: 'Especialidades'
        })
        .navGrid('#pager',
        {
            edit: true,
            add: false,
            del: {
                url: '@Url.Action("delete", "Especialidade")'
            },
            search: false
        })
       .navButtonAdd('#pager', {
           caption: "Add",
           buttonicon: "ui-icon-add",
           onClickButton: function () {
               alert("Adding Row");
           },
           position: "last"
       })
       .navButtonAdd('#pager', {
           caption: "Del",
           buttonicon: "ui-icon-del",
           onClickButton: function () {
               alert("Deleting Row");
           },
           position: "last"
       });

        jQuery("#grid").jqGrid('setGroupHeaders', {
            useColSpanStyle: true,
            groupHeaders: [
              { startColumnName: 'Esp_SisGst', numberOfColumns: 1, titleText: 'Cód.Sis.' },
              { startColumnName: 'Esp_AltCpx', numberOfColumns: 1, titleText: 'Alta' },
              { startColumnName: 'Esp_IddMin', numberOfColumns: 2, titleText: 'Idade' },
              { startColumnName: 'Esp_QtdMax', numberOfColumns: 4, titleText: 'Quantidades' }
            ]
        });
    }

    function linkFormatter(cellvalue, options, rowObject) {
        return "<a href=/Especialidade/Edit/" + cellvalue + ">" + cellvalue + "</a>";
    }

    function BuildLote(pId, pObject) {

        var confirmar = confirm('Confirmar a geração dos lotes?');
        
        if (confirmar) {
            var url = '/especialidade/edit/' + pId;
            window.location.replace(url);
            @*window.location.replace('@Url.Action("edit", "Especialidade")');*@
            pObject.onclick = null;
            pObject.innerHTML = "";
            var img = document.createElement("IMG");
            img.src = '@Url.Content("~/Images/loading.gif")';
            pObject.appendChild(img);

            $.ajax({

                type: "GET",
                url: '@Url.Action("Edit", "Especialidade")',
                        dataType: "json",
                        contentType: "application/json",
                        async: true,
                        data: "{'pId': '" + pId + "'}",
                        complete: function (response, status) {
                            ShowMessage('Mensagem', response.responseText + ' lote(s) gerado(s) com sucesso!', false, 5000);
                            jQuery("#grid").trigger("reloadGrid", [{ page: 1 }]);
                        },
                        error: function () {

                        }
		     });

                }
            }

            function CompetenciaFormatter(cell, options, row) {
                return "<div class=\"cursor\" id=\"divFechar\"><span class=\"action\" onclick=\"BuildLote(" + cell + ",this);\" id=\"fechar\">Fechar</span></div>";
            }
</script>
 
<table id="grid" class="scroll" cellpadding="0" cellspacing="0"></table>
<div id="pager" class="scroll" style="text-align:center;"></div> 

@*@using MvcJqGrid
@using MvcJqGrid.Enums

<div style="width: 900px">
@(Html.Grid("Basic")
    .SetCaption("Basic Grid")
    .AddColumn(new Column("IdEsp").SetLabel("Id").SetWidth(50))
    .AddColumn(new Column("Esp_Dsc").SetLabel("Nome").SetWidth(200))
    .AddColumn(new Column("Esp_Cbo").SetLabel("CBO").SetWidth(80))
    //.SetUrl("/MvcJqGrid/Home/GridDataBasic")
    .SetUrl(Url.Action("Lista", "especialidade"))
    .SetAutoWidth(true)
    .SetRowNum(10)
    .SetRowList(new[]{10,15,20})
    .SetViewRecords(true)
    .SetPager("pager"))
</div>*@




@*@using MvcJqGrid

@model IEnumerable<br.com.totaltiss.Model.Atz_Esp>

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqgrid")

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>

@using (Html.BeginForm())
{
    <p>
        Find by name: @Html.TextBox("SearchString")  
        <input type="submit" value="Search" /></p>
}

<table>
    <tr>
        <th>
            @Html.ActionLink("Nome", "Index", new { sortOrder=ViewBag.DscSortParm })
        </th>
        <th>
            @Html.ActionLink("CBO", "Index", new { sortOrder=ViewBag.CBOSortParm })
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_SisGst)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_AltCpx)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_Sxo)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_IddMin)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_IddMax)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_QtdMax)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_QtdDia)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_QtdMes)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_QtdAno)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Esp_Rtn)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_Dsc)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_Cbo)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_SisGst)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_AltCpx)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_Sxo)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_IddMin)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_IddMax)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_QtdMax)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_QtdDia)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_QtdMes)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_QtdAno)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Esp_Rtn)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.IdEsp }) |
            @Html.ActionLink("Details", "Details", new { id=item.IdEsp }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.IdEsp })
        </td>
    </tr>
}

</table>*@
